window.angular.module('Outhouse.categories.controller', ['Outhouse.categories.service'])
  .controller('CategoriesController', ['$scope', '$rootScope', '$timeout', '$routeParams', '$location', 'Categories',
    function($scope, $rootScope, $timeout, $routeParams, $location, Categories) {

      if (!$rootScope.opacity) {
        $rootScope.opacity = {'val':0};
      }

      $scope.$watch('mytime', function(data) {
        var min = data.getMinutes();
        var hour = data.getHours();
        $rootScope.opacity.val = Math.abs(((hour+(min/60))-12)/24);
      })

      if (!$routeParams.time) {
        $scope.mytime = new Date();
      } else {
        $scope.mytime = new Date(parseInt($routeParams.time)*1000);
      }

      $scope.unixtime = Math.round($scope.mytime.getTime()/1000);

      $scope.hstep = 1;
      $scope.mstep = 30;

      $scope.options = {
        hstep: [1, 2, 3],
        mstep: [1, 5, 10, 15, 25, 30]
      };

      $scope.ismeridian = true;
      $scope.toggleMode = function() {
        $scope.ismeridian = ! $scope.ismeridian;
      };

      $scope.update = function() {
        var d = new Date();
        d.setHours( 14 );
        d.setMinutes( 0 );
        $scope.mytime = d;
      };

      $scope.changed = function () {
        // console.log('Time changed to: ' + Math.round($scope.mytime.getTime()/1000));
        $scope.unixtime = Math.round($scope.mytime.getTime()/1000);
      };

      $scope.clear = function() {
        $scope.mytime = null;
      };

      $scope.categories = [
        {
          "val": "New Foods & Desserts",
          "title": "Food",
          "img": "<%= image_path 'food.png' %>"
        },
        {
          "val": "Going Shopping",
          "title": "Shopping",
          "img": "<%= image_path 'shop.png' %>"
        },
        {
          "val": "Getting Outside",
          "title": "Parks",
          "img": "<%= image_path 'tree.png' %>"
        },
        {
          "val": "Fall Fun",
         "title": "Haunted House",
          "img": "<%= image_path 'pumpkin.png' %>"
        },
        {
          "val": "Berkeley Lectures",
         "title": "Lecture",
          "img": "<%= image_path 'prof.png' %>"
        },
        {
          "val": "Quiet Study",
         "title": "Study",
          "img": "<%= image_path 'book.png' %>"
        }
      ]

      $scope.find = function (query) {
        Categories.query(query, function (categories) {
          $scope.categories = categories;
        });
      };
    }])