'use strict';

window.angular.module('Outhouse.categories.service', [])
  .factory('Categories', [function () {
    var cats = [
      {
        "val": "New Foods & Desserts",
        "title": "Food",
        "img": "<%= image_path 'food.png' %>",
        "schedule": {
          "sun": [{"start": 0, "end": 2400}],
          "mon": [{"start": 0, "end": 2400}],
          "tue": [{"start": 0, "end": 2400}],
          "wed": [{"start": 0, "end": 2400}],
          "thu": [{"start": 0, "end": 2400}],
          "fri": [{"start": 0, "end": 2400}],
          "sat": [{"start": 0, "end": 2400}]},
        "parent": "root"
      },
      {
        "val": "Going Shopping",
        "title": "Shopping",
        "img": "<%= image_path 'shop.png' %>",
        "schedule": {
          "sun": [{"start": 0, "end": 2400}],
          "mon": [{"start": 0, "end": 2400}],
          "tue": [{"start": 0, "end": 2400}],
          "wed": [{"start": 0, "end": 2400}],
          "thu": [{"start": 0, "end": 2400}],
          "fri": [{"start": 0, "end": 2400}],
          "sat": [{"start": 0, "end": 2400}]},
        "parent": "root"
      },
      {
        "val": "Getting Outside",
        "title": "Parks",
        "img": "<%= image_path 'tree.png' %>",
        "schedule": {
          "sun": [{"start": 0, "end": 2400}],
          "mon": [{"start": 0, "end": 2400}],
          "tue": [{"start": 0, "end": 2400}],
          "wed": [{"start": 0, "end": 2400}],
          "thu": [{"start": 0, "end": 2400}],
          "fri": [{"start": 0, "end": 2400}],
          "sat": [{"start": 0, "end": 2400}]},
        "parent": "root"
      },
      {
        "val": "Fall Fun",
        "title": "Haunted House",
        "img": "<%= image_path 'pumpkin.png' %>",
        "schedule": {
          "sun": [{"start": 0, "end": 2400}],
          "mon": [{"start": 0, "end": 2400}],
          "tue": [{"start": 0, "end": 2400}],
          "wed": [{"start": 0, "end": 2400}],
          "thu": [{"start": 0, "end": 2400}],
          "fri": [{"start": 0, "end": 2400}],
          "sat": [{"start": 0, "end": 2400}]},
        "parent": "root"
      },
      {
        "val": "Berkeley Lectures",
        "title": "Lecture",
        "img": "<%= image_path 'prof.png' %>",
        "schedule": {
          "sun": [{"start": 0, "end": 2400}],
          "mon": [{"start": 0, "end": 2400}],
          "tue": [{"start": 0, "end": 2400}],
          "wed": [{"start": 0, "end": 2400}],
          "thu": [{"start": 0, "end": 2400}],
          "fri": [{"start": 0, "end": 2400}],
          "sat": [{"start": 0, "end": 2400}]},
        "parent": "root"
      },
      {
        "val": "Quiet Study",
        "title": "Study",
        "img": "<%= image_path 'book.png' %>",
        "schedule": {
          "sun": [{"start": 0, "end": 2400}],
          "mon": [{"start": 0, "end": 2400}],
          "tue": [{"start": 0, "end": 2400}],
          "wed": [{"start": 0, "end": 2400}],
          "thu": [{"start": 0, "end": 2400}],
          "fri": [{"start": 0, "end": 2400}],
          "sat": [{"start": 0, "end": 2400}]},
        "parent": "root"
      },
      {
        "val": "Berkeley Lectures",
        "title": "Study",
        "img": "<%= image_path 'prof.png' %>",
        "schedule": {
          "sun": [{"start": 0, "end": 2400}],
          "mon": [{"start": 0, "end": 2400}],
          "tue": [{"start": 0, "end": 2400}],
          "wed": [{"start": 0, "end": 2400}],
          "thu": [{"start": 0, "end": 2400}],
          "fri": [{"start": 0, "end": 2400}],
          "sat": [{"start": 0, "end": 2400}]},
        "parent": "shopping"
      }
    ];

    var isBetween = function(time, range) {
      return (time >= range.start && time <= range.end)
    };

    return {
      getActiveCats: function(parent){
        var arr = []
        var d = new Date()
        var t = d.getHours() * 100 + d.getMinutes()
        var dow = ["sun","mon","tue","wed","thu","fri","sat"][d.getDay()];

        angular.forEach(cats, function (cat){
          if(cat.parent === parent){
            angular.forEach(cat.schedule[dow], function (r){
              if(isBetween(t, r)){
                arr.push(cat);
              }
            })
          }
        });

        return arr;
      },

      getAllCats: function(){
        return cats;
      }
    };
  }]);

// Before:
// ['$resource', function ($resource) {
//     return $resource(
//       'categories/:categoryId',
//       {
//         update: { method: 'PUT' }
//     }
//   );
// }]